{% extends 'Venter/base.html' %}
{% block title %}Prediction Table {% endblock %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../../static/assets/css/prediction_table.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <script>
        function toggleField(hideObj,showObj){
            hideObj.disabled=true;		
            hideObj.style.display='none';
            showObj.disabled=false;	
            showObj.style.display='inline';
            showObj.focus();
        }

        function colorcode(num, index) {
            if (num > 90) {
                $("#" + index).attr("style", "background-color: #00a33b");
            } else if (num > 80) {
                $("#" + index).attr("style", "background-color: #06d636");
            } else if (num > 70) {
                $("#" + index).attr("style", "background-color: #4ee802");
            } else if (num > 60) {
                $("#" + index).attr("style", "background-color: #c3ff00");
            } else if (num > 50) {
                $("#" + index).attr("style", "background-color: #f6ff00");
            } else if (num > 40) {
                $("#" + index).attr("style", "background-color: #ffe100");
            } else if (num > 30) {
                $("#" + index).attr("style", "background-color: #ffbb00");
            } else if (num > 20) {
                $("#" + index).attr("style", "background-color: #ff8c00");
            } else if (num > 10) {
                $("#" + index).attr("style", "background-color: #ff5900");
            } else {
                $("#" + index).attr("style", "background-color: #af0101");
            }
        }

        $(document).on("click", ".delete-category-btn", function() {
            var parent = $(this).closest("li");
            parent.remove();
        });


        function add_category(ul_id, select_id, input_id){
            var ul = $("#"+ul_id);
            if ($("#"+select_id)[0].selectedIndex<=0)
            {
                var cat_from_input = $("#"+input_id).val();
                if (!cat_from_input.replace(/\s/g, '').length)
                {
                    alert("Please enter a valid input");
                }
                else
                    {
                        added_category = cat_from_input;
                        console.log("cat with $(#input_id): ", added_category);
                        $(ul)
                            .append('<li class="list-group-item">'+added_category+'&nbsp;&nbsp;<button type="button" class="delete-category-btn"><i class="fa fa-times delete-fa" aria-hidden="true"></i></button></li>')
                    }
                $("#"+input_id).val("");
            }
            else{
            var cat_from_select = $("#"+select_id).val();
            if (cat_from_select == '0'){
                alert("Please select a valid category");
            }
            else{
                added_category = cat_from_select;
                console.log("cat with $(#select_id): ", added_category);
                $(ul)
                    .append('<li class="list-group-item">'+added_category+'&nbsp;&nbsp;<button type="button" class="delete-category-btn"><i class="fa fa-times delete-fa" aria-hidden="true"></i></button></li>')
            }   
            $("#"+select_id)[0].selectedIndex = 0;
            }
        }
    </script>


<div class="outer-pt">
    <div class="inner-pt">

        <div class="row">
            <div class="col-sm-9">
                <form action="" method="get">
                    <div class="form-group row">
                        <div class="col-sm-1">
                            <input type="submit" value="Search" class="btn btn-primary active">
                        </div>&nbsp;&nbsp;
                        <div class="col-sm-7">
                            <input type="text" name="q" id="myInput" class="form-control" placeholder="Search file">
                        </div>    
                    </div>
                </form>
            </div>
            <div class="col-sm-1">
                <a href="">
                <button type="button" class="btn btn-primary download-button">
                    Download File &nbsp;<i class="fa fa-download download-fa" aria-hidden="true"></i>
                </button>
                </a>
            </div>
        </div><br>

        <div id="container-table">
            <table class="table table-bordered table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Highest Confidence</th>
                        <th class="table-cell-cat">Predicted Categories</th>
                        <th>Problem Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in dict_list %}
                    <tr>
                        <td class="table-cell-conf-score" id="td{{ item.index }}">{{ item.highest_confidence }}%</td>
                        <td class="table-cell-cat">
                            <script>colorcode("{{item.highest_confidence}}", "td{{ item.index }}");</script>  
                            <div class="form-group">
                                <ul class="list-group category_list" id="ul{{ item.index }}">
                                        {% for cat, prob in item.category.items %}
                                            <li class="list-group-item">
                                                {{ cat }} ({{prob}})%
                                            </li>
                                        {% endfor %}
                                </ul><br>     
                                <div class="input-group">                           
                                    <select name="category" id="select{{ item.index }}" class="select_cat" onchange="if(this.options[this.selectedIndex].value=='customOption'){toggleField(this,this.nextSibling); this.selectedIndex='0';}">
                                        <option value="0">---- select ----</option>
                                        <option value="customOption">[enter your own custom category]</option>
                                        {% for cat in category_list %}
                                            <option value="{{ cat }}">{{ cat }}</option>
                                        {% endfor %}
                                        <input name="category" id="input{{ item.index }}" class="input_cat" type="text" placeholder="Type category to add" disabled="disabled" onblur="if(this.value==''){toggleField(this,this.previousSibling);}">
                                    </select>
                                        
                                    <button type="button" id="add-category-btn" class="add-category-btn" onclick="add_category('ul{{ item.index }}', 'select{{ item.index }}','input{{ item.index }}');">
                                        <i class="fa fa-plus plus-fa" aria-hidden="true"></i>
                                    </button>   
                                </div>
                            </div>
                        </td>
                        <td>{{ item.problem_description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>  
</div>    
{% endblock %}
